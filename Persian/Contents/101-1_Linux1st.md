# _101.1_ تعیین و پیکربندی تنظیمات سخت‌افزاری

#### درجه سختی : _2_
#### هدف : داوطلبان باید بتوانند سخت‌افزار اساسی سیستم را تعیین و پیکربندی کنند.

در این مقاله به بررسی روش‌های تعیین و پیکربندی تنظیمات سخت‌افزاری در لینوکس می‌پردازیم. این راهنما شامل دستورات و ابزارهای مفید برای مدیریت سخت‌افزار در سیستم‌های لینوکسی است.

### اهداف

- فعال و غیرفعال کردن سخت افزار های داخلی
- تفاوت بین انواع مختلف دستگاه‌های ذخیره‌سازی
- تعیین منابع سخت‌افزاری برای دستگاه‌ها
- ابزارها و برنامه‌های کمکی برای فهرست کردن اطلاعات سخت‌افزارهای مختلف (مثلاً lsusb، lspci و غیره)
- ابزارها و برنامه‌های کاربردی برای دستکاری دستگاه‌های USB
- درک مفهومی از sysfs، udev، dbus
- **`/sys`**
- **`/proc`**
- **`/dev`**
- modprobe
- lsmod
- lspci 
- lsusb

## سیستم عامل (Operating System)

نرم‌افزار سیستمی است که سخت‌افزار کامپیوتر و منابع نرم‌افزاری را مدیریت می‌کند و سرویس‌های مشترکی را برای برنامه‌های کامپیوتری فراهم می‌کند. این نرم‌افزار روی سخت‌افزار قرار می‌گیرد و منابع را در صورت درخواست سایر نرم‌افزارها (که گاهی اوقات برنامه فضای کاربری نامیده می‌شود) مدیریت می‌کند.

## نرم افزار Firmware

کد های سطح پایین که روی تراشه‌های سخت‌افزاری ذخیره شده‌اند و قبل از OS اجرا می‌شوند.

در مادربرد میتوان به BIOS(Basin Input/Output System) و UEFI(Unifed Extensible Firmware Interface) اشاره کرد.

بدون firmware، سخت‌افزار نمی‌تواند با OS ارتباط برقرار کند.

### فریمور BIOS (Basic Input/Output System)


وظیفه این Firmware ، راه‌اندازی اولیه و بارگذری bootloader از MBR و تست سخت افزارها در Boot میباشد.
به دلیل حافظه کم به صورت دو مرحله ای عملیات بوت را انجام میدهد.

![image](https://github.com/user-attachments/assets/54e6c9b4-9ad2-48b1-beaf-1811fada15cb)


#### مطالعه بیشتر

سکتور MBR (Master Boot Record) اولین سکتور (۵۱۲ بایت) روی دیسک است که شامل :

- کد بوت (۴۴۶ بایت).
- پارتیشن‌تیبل (۶۴ بایت).
- امضای بوت (۲ بایت).

### فریمور UEFI (Unified Extensible Firmware Interface)

جایگزین BIOS میباشد که از دیسک هایی با ظرفیت بیشتر از 2.2TB پشتیبانی میکند. از فایل های اجرایی (FAT) در `/boot` در ESP (EFI System Partition) برای بوت کامپیوتر استفاده میکند

![image](https://github.com/user-attachments/assets/6dc0b033-108e-4609-8aa6-7cee94b79088)

## استاندارد PCI (Peripheral Component Interconnect)

استاندارد اتصال قطعات سخت‌افزاری به مادربرد می باشد. اتصال داخلی قطعات جانبی. کاربر را قادر می‌سازد تا قطعات اضافی را به مادربرد اضافه کند. اکنون اکثر سرورها از PCI Express (PCIe) استفاده می‌کنند.

استاندارد PCI نسخه قدیمی تر و نسخه PCIe نسخه سریع‌تر با لینک‌های اختصاصی است.

با استفاده از دستور `lspci` میتوان دستگاه های متصل را مشاهده نمود.

![image](https://github.com/user-attachments/assets/aae79fda-7f94-4366-9fe6-96a3b7df61ce)


## استاندارد USB (Universal Serial Bus)

استاندارد ارتباطی برای اتصال دستگاه‌های جانبی به کامپیوتر است.
رابط USB قابلیت تعویض سریع [(hot-swappable)](https://en.wikipedia.org/wiki/Hot_swapping) دارد (دستگاه‌ها را می‌توان بدون خاموش کردن کامپیوتر میزبان تعویض کرد).

میتوان از دستور `lsusb` برای نمایش فهرست دستگاه های متصل از طریق USB استفاده کرد.

![image](https://github.com/user-attachments/assets/e3ff87ab-a3ee-4e93-986e-b09ea49622c4)

## پین های GPIO (General Purpose Input Output)

به پین‌های برنامه‌پذیر برای ارتباط با سخت‌افزارهای سفارشی (مثل Arduino و raspberrypi و ...) که روی مدار های الکتریکی قرار دارند گفته می شود.
از GPIO برای کنترل LED، سنسورها، رله و ... استفاده می شود.


![image](https://github.com/user-attachments/assets/44cb3e4a-2336-496e-a165-bf64375113f3)


## سیستم فایل (Sysfs)

تعریف: یک سیستم فایل مجازی (virtual filesystem) که اطلاعات دستگاه‌ها (devices) و درایورها (drivers) را از هسته (kernel) به فضای کاربر (user space) نمایش می‌دهد. دسترسی از طریق آدرس `/sys`.

کاربردها : 
- مدیریت دستگاه‌های متصل به سیستم (مثل USB، PCI، GPU و...).
- تغییر تنظیمات سخت‌افزاری به صورت داینامیک (مثل روشن/خاموش کردن LED).
- مشاهده اطلاعات دستگاه‌ها مانند مدل، وضعیت، مصرف انرژی و...

### مثال
``` bash
username:~$ ls /sys/class/net/  # لیست کارت‌های شبکه
```
``` bash
username:~$ echo 1 > /sys/class/leds/input3::capslock/brightness  # تغییر وضعیت LED
```
``` bash
username:~$ ls /sys
block  bus  class  dev  devices  firmware  fs  hypervisor  kernel  module  power
```

## مدیریت دستگاه ها (udev)

یک مدیریت کننده دستگاه (device manager) در لینوکس که مسئول:

- شناسایی دستگاه‌های متصل به صورت داینامیک (مثل USB، هارد اکسترنال).
- ایجاد فایل‌های دستگاه (/dev/...) به صورت خودکار.
- اعمال قوانین (rules) برای نامگذاری یا دسترسی به دستگاه‌ها.

### ساختار و محل فایل‌های مهم
- پیکربندی‌های سیستم‌ادمین `/etc/udev/`
- قوانین و اسکریپت‌های پیش‌فرض `/lib/udev/`
- فایل‌های موقت و حالت سیستم `/run/udev/`
- گره‌های دستگاه که توسط udev ایجاد می‌شوند `/dev/`

### مثال
``` bash
udevadm monitor  # مشاهده رویدادهای دستگاه‌ها
udevadm info /dev/sda  # اطلاعات دستگاه
```

## سیستم D-Bus (Desktop Bus)

یک سیستم ارتباط بین پردازشی (IPC) که امکان ارتباط بین فرآیندهای کاربر و سیستم را فراهم می‌کند.

کاربردها:

- ارتباط بین برنامه‌های کاربردی و سرویس‌های سیستم (مثل اعلان‌ها، مدیریت انرژی).
- کنترل سرویس‌هایی مانند NetworkManager، Bluetooth و...

### مثال

``` bash
dbus-monitor  # مشاهده پیام‌های D-Bus
```

## سیستم Proc (Procfs)

یک سیستم فایل مجازی (`/proc/`) که اطلاعات فرآیندها (processes) و سیستم را از هسته نمایش می‌دهد.

### ساختار و محل فایل‌های مهم

- اطلاعات پردازنده `/proc/cpuinfo`
- اطلاعات حافظه `/proc/meminfo`
- لیست IRQها `/proc/interrupts`
- محدوده آدرس‌های I/O `/proc/ioports`
- کانال‌های DMA فعال `/proc/dma`

## دستورات lsusb, lspci, lsblk, lshw

- دستور lsusb: نمایش دستگاه‌های متصل به پورت USB <br/>
مثال: `lsusb -v` (نمایش جزئیات کامل)

- دستور lspci: نمایش دستگاه‌های متصل به اسلات PCI/PCIe <br/>
مثال: `lspci -nn` (نمایش کدهای شناسه سازنده)

- دستور lsblk: نمایش بلوک‌دیوایس‌ها (دیسک‌ها و پارتیشن‌ها) <br/>
مثال: `lsblk -f` (نمایش با اطلاعات فایل‌سیستم)

- دستور lshw: نمایش جامع اطلاعات سخت‌افزاری سیستم <br/>
مثال: `sudo lshw -short` (نمایش خلاصه)

## ماژول‌های کرنل (Loadable Kernel Modules)

لینوکس مانند هر سیستم عامل دیگری برای کار با سخت‌افزار به درایور نیاز دارد. در مایکروسافت ویندوز، باید درایورها را جداگانه نصب کنید، اما در لینوکس، سیستم اکثر درایورها را به صورت داخلی دارد. اما برای جلوگیری از بارگذاری همزمان همه آنها توسط هسته و کاهش اندازه هسته، لینوکس از ماژول‌های هسته استفاده می‌کند. ماژول‌های هسته قابل بارگذاری (فایل‌های .ko) فایل‌های شیء هستند که برای گسترش هسته توزیع لینوکس استفاده می‌شوند. آنها برای ارائه درایور برای سخت‌افزارهای جدید مانند کارت‌های توسعه IoT که در توزیع لینوکس گنجانده نشده‌اند، استفاده می‌شوند.

### دستورات
- دستور `lsmod` : نمایش ماژول‌های بارگذاری شده
- دستور `modprobe` : بارگذاری/حذف ماژول‌ها (مثال: sudo modprobe usb_storage)
- دستور `rmmod` : حذف ماژول (مثال: sudo rmmod module_name)

### مثال : 
``` bash
lsusb | grep -i "Logitech" # بررسی دستگاه‌های USB
```
``` bash
lsblk -o NAME,SIZE,FSTYPE,MOUNTPOINT # مشاهده دیسک‌ها و پارتیشن‌ها
```
``` bash
sudo modprobe snd_hda_intel # بارگذاری ماژول کارت صدا
```



### جمع‌بندی مفاهیم کلیدی
- بوت‌لودر: BIOS از MBR استفاده می‌کند، اما UEFI از GPT و پارتیشن ESP.
- فایل‌سیستم: MBR محدودیت دارد، اما GPT برای دیسک‌های بزرگ مناسب است.
- سخت‌افزار: PCI/USB برای اتصال دستگاه‌ها، GPIO برای پروژه‌های توکار.
- سیستم فایل Sysfs: نمایش اطلاعات دستگاه‌ها در /sys/
- مدیریت دستگاه ها Udev: مدیریت خودکار دستگاه‌های متصل
- سیستم Procfs: اطلاعات سیستم و فرآیندها در /proc/
